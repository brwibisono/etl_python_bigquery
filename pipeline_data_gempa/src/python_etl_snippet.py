# -*- coding: utf-8 -*-
"""python_etl_snippet.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1t4yBsb0TCrUrUiyZyAcAcmrHQ_p8zale
"""

"""
üì¶ Indonesia Earthquake ETL Snippet
Author: Bramantya Wibisono (brbelajardata)
Description: Extract data from USGS API ‚Üí Transform with pandas ‚Üí Load to BigQuery
"""

import pandas as pd
import requests
from google.cloud import bigquery

# 1Ô∏è‚É£ Extract: Ambil data dari API USGS
url = "https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&limit=100"
response = requests.get(url)
data_json = response.json()

# 2Ô∏è‚É£ Transform: Normalisasi JSON ke DataFrame
df = pd.json_normalize(data_json["features"])

# 3Ô∏è‚É£ Tambahkan metadata waktu ingestion
df["ingested_at"] = pd.Timestamp.now(tz="Asia/Jakarta")

# 4Ô∏è‚É£ Load: Kirim ke BigQuery (contoh table)
df.to_gbq(
    destination_table="brbelajardata.data_gempa_indonesia.raw_data",
    project_id="brbelajardata",
    if_exists="replace"
)

print("‚úÖ ETL berhasil dijalankan: Data terbaru telah dimuat ke BigQuery.")